<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mum Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div class="dashboard">

    <h1>Mum Dashboard</h1>

    <div class="chores">
      <button onclick="loadChild('alexander')">
        Alexander
      </button>
      
      <button onclick="loadChild('conor')">
        Conor
      </button>
    </div>

    <div class="status">
      <h2>Pending Chores</h2>
      <ul id="pendingList"></ul>
    </div>

    <div class="money">
      Balance: $<span id="mumBalance">0</span>
    </div>

    <div class="chores">
      <button onclick="cashOut()">Cash Out</button>
    </div>

  </div>

  <script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  updateDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAlkbSQOQNk9RDssqaezwcYINZYxCX09O0",
  authDomain: "small-change-app.firebaseapp.com",
  projectId: "small-change-app",
  storageBucket: "small-change-app.firebasestorage.app",
  messagingSenderId: "84595380385",
  appId: "1:84595380385:web:a66bfd44290e958ed720e0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentChild = null;

async function loadChild(childName) {
  currentChild = childName;
  renderPending();
}

async function renderPending() {
  const list = document.getElementById("pendingList");
  list.innerHTML = "";

  const snapshot = await getDocs(collection(db, "chores"));

  snapshot.forEach((docSnap) => {
    const chore = docSnap.data();

    if (
      chore.status === "pending" &&
      chore.child === currentChild
    ) {
      const li = document.createElement("li");

      li.innerHTML = `
        ${chore.name} - $${chore.value}
        <button onclick="approve('${docSnap.id}', ${chore.value})">
          Approve
        </button>
      `;

      list.appendChild(li);
    }
  });
}

async function approve(choreId, value) {
  const choreRef = doc(db, "chores", choreId);

  await updateDoc(choreRef, {
    status: "available"
  });

  // TODO: Add balance update here once we structure balances in Firestore

  renderPending();
}

window.loadChild = loadChild;
window.approve = approve;

</script>

</body>
</html>
